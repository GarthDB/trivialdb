<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>JBase by Morgul</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>JBase</h1>
        <h2>A lightweight key/value json storage with persistence and a simple model api.</h2>
        <a href="https://github.com/Morgul/jbase" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="jbase" class="anchor" href="#jbase" aria-hidden="true"><span class="octicon octicon-link"></span></a>JBase</h1>

<p><a href="https://travis-ci.org/Morgul/jbase"><img src="https://travis-ci.org/Morgul/jbase.svg?branch=master" alt="Build Status"></a></p>

<p>A lightweight key/value json storage with persistence. Conceptually, it's just a thin API wrapper around plain javascript
objects; with the added bonus of doing throttled asynchronous writes on changes. Its on disk format is simply "json on
disk"; basically the jsonified version of the plain object, saved to a file on disk. This makes making hand edits not
just possible, but simple.</p>

<h2>
<a id="use-case" class="anchor" href="#use-case" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use Case</h2>

<p>JBase is intended for simple storage needs. It's in-process, small, and very fast for small data sets. It takes almost
nothing to get up and going with it, and it has just enough features to make it worth while. Personally I've found its
a great fit for a development database for websites, or even to power a simple blog.</p>

<p>The one caveat to keep in mind is this: <em>every database your work with is stored in memory</em>. Since JBase is in-process,
you might run into the memory limit of node; on versions before 0.11+ there's a 1.4GB limit. If you try and load a
database of all your cat pictures, you might run out of memory pretty quickly.</p>

<p>That being said, this isn't actually much of a limitation. Generally, you're working with a large amount of your data
in memory anyway; your data sets can get relatively large before you even need to worry about this.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Simply install with npm:</p>

<div class="highlight highlight-bash"><pre>$ npm install --save jbase</pre></div>

<h2>
<a id="api" class="anchor" href="#api" aria-hidden="true"><span class="octicon octicon-link"></span></a>API</h2>

<p>The JBase API is inspired (spiritually) by <a href="http://rethinkdb.com/">RethinkDB</a> and it's node.js ORM,
<a href="http://thinky.io/">thinky</a>. These are two great projects, and once you outgrow JBase, I strongly encourage you to
check them out!</p>

<p>There are two different APIs, the low-level 'Database' API, and the higher level 'Model' API. Previous versions of JBase
only had the Database API, so if you want to use what you're used to, feel free to keep using it. (You can even use both
together in various ways.)</p>

<h3>
<a id="model-api" class="anchor" href="#model-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model API</h3>

<p>The model API was added to make JBase feel much more like the larger ORM style solutions out there. I'm a very big fan
of working with models as opposed to direct database calls, and I've taken some of my favorite features and baked them
directly into JBase. Here's the current feature list:</p>

<ul>
<li>Model validation</li>
<li>Simple model definitions</li>
<li>Models serialize as JSON objects</li>
<li>Get &amp; Filter functions that return model instances</li>
<li>Automatic syncing of database changes to Model instances</li>
<li>Manual syncing of Model instances with the database</li>
</ul>

<p>Don't worry, you are not required to use the Model API, or even know it's there.</p>

<h4>
<a id="defining-a-model" class="anchor" href="#defining-a-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining a model</h4>

<ul>
<li>
<code>defineModel(databaseName, modelDefinition, databaseOptions)</code> - Returns a <code>JDBModel</code>.</li>
</ul>

<p>Defining a model in JBase is very simple. Models and databases have a one to one relationship, so you can think of the
<code>databaseName</code> as the name of the model, though they don't have to have an relation to each other.</p>

<p><em>Note</em>: You will need to save the return value of <code>defineModel</code> and use that for querying or creating new instances.</p>

<div class="highlight highlight-javascript"><pre>
<span class="pl-c">// Define a user model</span>
<span class="pl-s">var</span> User <span class="pl-k">=</span> jbase.defineModel(<span class="pl-s1"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span>, {
    name<span class="pl-k">:</span> { type<span class="pl-k">:</span> <span class="pl-s3">String</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span> },
    age<span class="pl-k">:</span> <span class="pl-s3">Number</span>,
    admin<span class="pl-k">:</span> { type<span class="pl-k">:</span> <span class="pl-s3">Boolean</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span>, <span class="pl-k">default</span><span class="pl-k">:</span> <span class="pl-c1">false</span> }
});

<span class="pl-c">// Define an in-memory only model</span>
<span class="pl-s">var</span> Session <span class="pl-k">=</span> jbase.defineModel(<span class="pl-s1"><span class="pl-pds">'</span>sessions<span class="pl-pds">'</span></span>, {
    userID<span class="pl-k">:</span> { type<span class="pl-k">:</span> <span class="pl-s3">String</span>, required<span class="pl-k">:</span> <span class="pl-c1">true</span> }
}, { writeToDisk<span class="pl-k">:</span> <span class="pl-c1">false</span> });</pre></div>

<h5>
<a id="type-definition-object" class="anchor" href="#type-definition-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Type Definition Object</h5>

<p>The model definition is a simple object where the value is either a javascript type (String, Boolean, Number, etc.), or
a type definition object. The supported options are:</p>

<ul>
<li>
<code>type</code> - Required. This must be a javascript type (String, Boolean, Number, etc).</li>
<li>
<code>required</code> - Optional. If false (the default), null and undefined are allowed values for this field.</li>
<li>
<code>default</code> - Optional. A value to default the field to. (This can easily be overwritten simply by assigning to the
field.)</li>
</ul>

<h4>
<a id="creating-a-model" class="anchor" href="#creating-a-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a Model</h4>

<p>To create a model, you simply create a new instance of the return value of <code>defineModel</code>, optionally passing in an
option to populate the model with.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Create a regular user</span>
<span class="pl-s">var</span> user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">User</span>({ name<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Some Person<span class="pl-pds">"</span></span>, age<span class="pl-k">:</span> <span class="pl-c1">23</span> });</pre></div>

<h4>
<a id="updating-a-model" class="anchor" href="#updating-a-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating a model</h4>

<p>Updating a model is as simple as modifying the model instance, and then calling save.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Create a regular user</span>
<span class="pl-s">var</span> user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">User</span>({ name<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Some Person<span class="pl-pds">"</span></span>, age<span class="pl-k">:</span> <span class="pl-c1">23</span> });

<span class="pl-c">// Make the user an admin</span>
user.admin <span class="pl-k">=</span> <span class="pl-c1">true</span>;

<span class="pl-c">// Save the user</span>
user.save();</pre></div>

<h4>
<a id="validating-a-model" class="anchor" href="#validating-a-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validating a Model</h4>

<ul>
<li>
<code>model.validate()</code> - Returns a promise that either resolves, or rejects with a <code>ValidationError</code>.</li>
</ul>

<p>All model instances have a <code>validate</code> function, which you can use to check to make sure the model is valid. When there
is a validation error, you will get a <code>ValidationError</code> object with a <code>key</code> property that indicates the key that failed
validation. You can catch this error using <code>.catch</code></p>

<p>Currently, we only validate based on type, or the type definition object's options.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Create a regular user</span>
<span class="pl-s">var</span> user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">User</span>({ name<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Some Person<span class="pl-pds">"</span></span>, age<span class="pl-k">:</span> <span class="pl-c1">23</span> });

<span class="pl-c">// Make the user an admin</span>
user.admin <span class="pl-k">=</span> <span class="pl-c1">true</span>;

<span class="pl-c">// This will resolve correctly.</span>
user.validate().then(<span class="pl-st">function</span>()
{
    <span class="pl-c">// We get here.</span>
});

<span class="pl-c">// Set the admin field to an invalid type</span>
user.admin <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>not valid<span class="pl-pds">'</span></span>;

<span class="pl-c">// This will throw an error.</span>
user.validate()
    .then(<span class="pl-st">function</span>()
    {
        <span class="pl-c">// We don't get here.</span>
    })
    .catch(jbase.errors.ValidationError, <span class="pl-st">function</span>()
    {
        <span class="pl-c">// We catch the error, and handle it here.</span>
    });</pre></div>

<h4>
<a id="saving-a-model" class="anchor" href="#saving-a-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Saving a Model</h4>

<ul>
<li>
<code>model.save(skipValidation)</code> - Returns a promise that either resolves, or rejects with an error.</li>
</ul>

<p>Saving a model is as simple as calling <code>save</code>. It first calls <code>validate</code>, which means that it may throw a
<code>ValidationError</code>.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Create a regular user</span>
<span class="pl-s">var</span> user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">User</span>({ name<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Some Person<span class="pl-pds">"</span></span>, age<span class="pl-k">:</span> <span class="pl-c1">23</span> });

<span class="pl-c">// Make the user an admin</span>
user.admin <span class="pl-k">=</span> <span class="pl-c1">true</span>;

<span class="pl-c">// Save the user</span>
user.save()
    .then(<span class="pl-st">function</span>()
    {
        <span class="pl-c">// Saved!</span>
    });</pre></div>

<h4>
<a id="syncing" class="anchor" href="#syncing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Syncing</h4>

<p>Normally, in an ORM, if you either create a new model instance, or get a model instance somehow, and something else
changes the database, your model instance is out of date and doesn't get those changes. However, because of the nature
of JBase, it was very easy to make the models smart enough to update themselves whenever something changes in the
database.</p>

<p>That being said, there is an issue of how do we merge your unsaved changes when something else has updated the database?
The design we've chosen is that whenever you model is dirty (<code>model.$dirty</code> is true), we ignore the <code>sync</code> event. You
can still manually sync the object.</p>

<h5>
<a id="manual-syncing" class="anchor" href="#manual-syncing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manual Syncing</h5>

<ul>
<li>
<code>model.sync(force)</code> - returns a promise that resolves once the sync has completed.</li>
</ul>

<p>If you want to sync your model instance (because you manually updated the database, for example), you can simply call
<code>sync</code>. However, if your model is dirty, you will need to force the sync by passing <code>true</code> to the <code>sync</code> function.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Create a regular user</span>
<span class="pl-s">var</span> user <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">User</span>({ name<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Some Person<span class="pl-pds">"</span></span>, age<span class="pl-k">:</span> <span class="pl-c1">23</span> });

<span class="pl-c">// Make the user an admin</span>
user.admin <span class="pl-k">=</span> <span class="pl-c1">true</span>;

<span class="pl-c">// Force a sync</span>
user.sync(<span class="pl-c1">true</span>)
    .then(<span class="pl-st">function</span>()
    {
        <span class="pl-c">// user.admin is false here.</span>
    });</pre></div>

<p>Keep in mind, when you force a sync, <em>all changes to the model instance will be lost</em>.</p>

<h4>
<a id="getting-a-model-by-id" class="anchor" href="#getting-a-model-by-id" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting a Model by ID</h4>

<ul>
<li>
<code>Model.get(modelID)</code> = returns a promise that either resolves with a model instance, ore rejects with a
<code>DocumentNotFound</code> error.</li>
</ul>

<p>You can easily get model instances by id. Simply call <code>Model.get</code> and pass in the id you're looking for. If the id does
not exist, the promise will be rejected with a <code>DocumentNotFound</code> error. You can easily test for this, and handle it
using <code>.catch</code>.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Get an existing id</span>
User.get(<span class="pl-s1"><span class="pl-pds">'</span>existing-id<span class="pl-pds">'</span></span>)
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">user</span>)
    {
        <span class="pl-c">// Work with user here</span>
    });

<span class="pl-c">// Get a non-existent id</span>
User.get(<span class="pl-s1"><span class="pl-pds">'</span>existing-id<span class="pl-pds">'</span></span>)
    .catch(jbase.errors.DocumentNotFound, <span class="pl-st">function</span>(<span class="pl-vpf">error</span>)
    {
        <span class="pl-c">// Handle not found case</span>
    });</pre></div>

<h4>
<a id="filtering-models" class="anchor" href="#filtering-models" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filtering models</h4>

<ul>
<li>
<code>Model.filter(filter)</code> - returns a promise that resolves to a list, or an error.</li>
</ul>

<p>Instead, if you want to get a list of possible values, you should use <code>filter</code>. Just like the Database API function of
the same name, we support filter functions, <code>_.pluck</code> and <code>_.where</code> style filters. The results are <em>always</em> as list, so
if nothing matched your filter, you will get back an empty list.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Get a list of admins</span>
User.filter({ admin<span class="pl-k">:</span> <span class="pl-c1">true</span> })
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">admins</span>)
    {
        <span class="pl-c">// Work with the list of admins.</span>
    });</pre></div>

<h4>
<a id="working-with-the-database" class="anchor" href="#working-with-the-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Working with the database</h4>

<p>You can work with the database object for a particular model by using the <code>$$db</code> object. While I don't recommend doing
things this way, should you need it, you can use it.</p>

<h3>
<a id="database-api" class="anchor" href="#database-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Database API</h3>

<p>This is the API that previous versions of JBase pioneered. It's relatively low-level, and if that's how you'd rather
work with your database, that's fine. It is still the primary focus of JBase.</p>

<h4>
<a id="new-in-100" class="anchor" href="#new-in-100" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>New in 1.0.0</strong>
</h4>

<p>The Database API has recently changed. As I've been building projects, I've discovered that Promise-based APIs are both elegant
and incredibly convenient. I have opted to make the almost entire API promise-based. This has a small performance hit on
individual operations, however, it also makes all calls asynchronous, which helps with JBase's ability to handle load.</p>

<p>If you do not like promises, or disagree with this change, then I recommend using
<a href="https://github.com/Morgul/jbase/releases/tag/v0.9.0">v0.9.0</a>.</p>

<h5>
<a id="promises" class="anchor" href="#promises" aria-hidden="true"><span class="octicon octicon-link"></span></a>Promises</h5>

<p>Because of the change to promises, JBase now exposes our internal Promise object as <code>jbase.Promise</code>, so you can
leverage it  if you want to. (We use <a href="https://github.com/petkaantonov/bluebird">bluebird</a>.)</p>

<div class="highlight highlight-javascript"><pre><span class="pl-s">var</span> jbase <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">'</span>jbase<span class="pl-pds">'</span></span>);
<span class="pl-s">var</span> Promise <span class="pl-k">=</span> jbase.Promise;

<span class="pl-c">// Work with `Promise` here</span></pre></div>

<h4>
<a id="loading-or-saving-databases" class="anchor" href="#loading-or-saving-databases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Loading or saving databases</h4>

<ul>
<li>
<code>db(databaseName, options)</code> - Returns a database instance.</li>
</ul>

<p>JBase lazily loads databases. JBase also creates databases if they don't exist. To load or create a database:</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Open or create a database</span>
<span class="pl-s">var</span> db <span class="pl-k">=</span> jbase.db(<span class="pl-s1"><span class="pl-pds">'</span>some_db<span class="pl-pds">'</span></span>);

<span class="pl-c">// Open or create a database, with options</span>
<span class="pl-s">var</span> db <span class="pl-k">=</span> jbase.db(<span class="pl-s1"><span class="pl-pds">'</span>some_db<span class="pl-pds">'</span></span>, { writeToDisk<span class="pl-k">:</span> <span class="pl-c1">false</span> });</pre></div>

<p>This will look for a file named <code>"./some_db.json"</code>. (If your database lives somewhere else, you can pass the <code>rootPath</code>
option in to the <code>db</code> call.)</p>

<h5>
<a id="new-in-100-1" class="anchor" href="#new-in-100-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>New in 1.0.0</h5>

<p>You can now request the same database multiple times, and get back the same instance. This allows you to request the
database by name in different places in your code, and not worry about the two database instance fighting with each
other. (The previous behavior was clearly broken, and resulted in very strange issues.)</p>

<p><em>Note</em>: When you request a database any other time than the first, the options are ignored. There is currently no way to
change a database's options at run time.</p>

<h5>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Options</h5>

<p>The options supported by the <code>db</code> call are:</p>

<div class="highlight highlight-javascript"><pre>{
    writeToDisk<span class="pl-k">:</span> <span class="pl-c1">true</span> | <span class="pl-c1">false</span>,  <span class="pl-c">// Whether or not to persist the database to disk. (Default: `true`)</span>
    loadFromDisk<span class="pl-k">:</span> <span class="pl-c1">true</span> | <span class="pl-c1">false</span>, <span class="pl-c">// Whether or not to read the database in from disk on load. (Default: `true`)</span>
    rootPath<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>,            <span class="pl-c">// The path to a folder that will contain the persisted database json files. (Default: './')</span>
    writeDelay<span class="pl-k">:</span> ...,            <span class="pl-c">// A number in milliseconds to wait between writes to the disk. (Default: 0)</span>
    prettyPrint<span class="pl-k">:</span> <span class="pl-c1">true</span> | <span class="pl-c1">false</span>   <span class="pl-c">// Whether or not the json on disk should be pretty printed. (Default: `true`)</span>
}</pre></div>

<h4>
<a id="storing-values" class="anchor" href="#storing-values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Storing Values</h4>

<ul>
<li>
<code>store(value)</code> - Returns a promise resolved with <code>key</code>.</li>
<li>
<code>store(key, value)</code> - Returns a promise resolved with <code>key</code>.</li>
</ul>

<p>Since JBase is a key/value storage, all values are stored under a key. This key is not part of the value that gets stored,
since JBase never modifies your value. Also, while you can specify a key, you will need to ensure it's unique (otherwise
it will silently overwrite). Instead, I recommend you let JBase create the key for you (by not passing one).</p>

<p>When you let JBase auto generate the key, you can find out what that key was by using <code>.then()</code>, which will be passed
the newly generated key.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Store an object</span>
db.store({ foo<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>bar!<span class="pl-pds">"</span></span>, test<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Apples<span class="pl-pds">"</span></span> })
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">key</span>)
    {
        <span class="pl-c">// Work with `key` here</span>
    };

<span class="pl-s">var</span> key <span class="pl-k">=</span> <span class="pl-c1">undefined</span>
<span class="pl-c">// We support auto generating keys whenever the key parameter is undefined.</span>
db.store(key, { foo<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>bar!<span class="pl-pds">"</span></span>, test<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Apples<span class="pl-pds">"</span></span> })
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">key</span>)
    {
        <span class="pl-c">// Work with `key` here</span>
    };

<span class="pl-c">// Store an object with key</span>
db.store(<span class="pl-s1"><span class="pl-pds">'</span>my_key<span class="pl-pds">'</span></span>, { foo<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>bar!<span class="pl-pds">"</span></span>, test<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Apples<span class="pl-pds">"</span></span> })
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">key</span>)
    {
        <span class="pl-c">// `key` == 'my_key'</span>
    };</pre></div>

<h4>
<a id="retrieving-values" class="anchor" href="#retrieving-values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Retrieving Values</h4>

<ul>
<li>
<code>get(key)</code> - Returns a promise resolved to the value or <code>undefined</code>.</li>
</ul>

<p>JBase only supports direct lookups by key. It returns a promise resolved to the value stored.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Get an object</span>
db.get(<span class="pl-s1"><span class="pl-pds">'</span>my_key<span class="pl-pds">'</span></span>)
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">val</span>)
    {
        <span class="pl-c">// Work with `val` here</span>
    });</pre></div>

<h4>
<a id="updating-values" class="anchor" href="#updating-values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating Values</h4>

<ul>
<li>
<code>merge(key, partialObj)</code> - Returns a promise resolved to the new value.</li>
</ul>

<p>JBase support partial object updates. JBase will take whatever object you pass in, and merge that object with the value
stored at that key. If there is no value, it works exactly like <code>store</code>. The resulting object is returned.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Update an object</span>
db.merge(<span class="pl-s1"><span class="pl-pds">'</span>my_key<span class="pl-pds">'</span></span>, { test<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>Oranges<span class="pl-pds">"</span></span> })
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">obj</span>)
    {
        <span class="pl-c">// Work with `obj` here</span>
    });
</pre></div>

<h4>
<a id="filter-queries" class="anchor" href="#filter-queries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Filter Queries</h4>

<ul>
<li>
<code>filter(filter)</code> - Returns a promise resolved to an object of filtered values.</li>
</ul>

<p>Sometimes, you need to query based on more than just the key. To do that, JBase gives you a very simple filter query. It
iterates over every value in the database, and passes that into your filter function. If the function returns true, that
value is included in the results, otherwise it's omitted.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Filter Function</span>
db.filter(<span class="pl-st">function</span>(<span class="pl-vpf">value</span>, <span class="pl-vpf">key</span>)
{
    <span class="pl-c">// Decide if you want this object</span>
    <span class="pl-k">return</span> value.foo <span class="pl-k">===</span> <span class="pl-s1"><span class="pl-pds">'</span>bar!<span class="pl-pds">'</span></span>;
}).then(<span class="pl-st">function</span>(<span class="pl-vpf">results</span>)
{
    <span class="pl-c">// Work with `results` here.</span>
});</pre></div>

<h5>
<a id="new-in-100-2" class="anchor" href="#new-in-100-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>New in 1.0.0</h5>

<p>You can now also pass in filter objects. We switched to using lodash under the hood, so we support their <code>_.pluck</code> &amp;
<code>_.where</code> style callbacks as well!</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Filter object</span>
db.filter({ foo<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">'</span>bar!<span class="pl-pds">'</span></span> })
    .then(<span class="pl-st">function</span>(<span class="pl-vpf">results</span>)
    {
        <span class="pl-c">// Work with `results` here.</span>
    });</pre></div>

<h4>
<a id="direct-access" class="anchor" href="#direct-access" aria-hidden="true"><span class="octicon octicon-link"></span></a>Direct Access</h4>

<ul>
<li>
<code>sync()</code> - Returns a promise resolved once the database is considered 'settled'.</li>
</ul>

<p>You can directly access the key/value store with the <code>values</code> property on the database instance. This is exposed
explicitly to allow you as much freedom to work with your data as you might want. However, JBase can't detect any
changes you make directly, so you will need to call the <code>sync</code> function to get your changes to persist to disk.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Add a new key manually</span>
db.values[<span class="pl-s1"><span class="pl-pds">'</span>foobar<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> { test<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>something<span class="pl-pds">"</span></span> };

<span class="pl-c">// Sync that new key to disk</span>
db.sync();</pre></div>

<p>The <code>sync</code> function returns a promise that is resolved once the database has 'settled', as in, there are not more
scheduled writes. Because of this behavior, you should consider whether or not you want to wait on it's promise. Under
high load, (or with a high <code>writeDelay</code>) it's possible for a <code>sync</code> promise's resolution to be considerably delayed.</p>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// Add a new key manually</span>
db.values[<span class="pl-s1"><span class="pl-pds">'</span>foobar<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> { test<span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>something<span class="pl-pds">"</span></span> };

<span class="pl-c">// Sync that new key to disk</span>
db.sync()
    .then(<span class="pl-st">function</span>()
    {
        <span class="pl-c">// Sync is done, db is settled</span>
    });</pre></div>

<p>Also, you should feel free to iterate over the values object if you need to do any advanced filtering. All the same
caveats of working with a plain javascript object apply. Just remember to call <code>sync</code> if you've made any modifications.</p>

<h5>
<a id="new-in-100-3" class="anchor" href="#new-in-100-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>New in 1.0.0</h5>

<p>Whenever <code>store</code> or <code>merge</code> are called, a <code>sync</code> event is fired from the database object. You can use this should you
need to know when JBase is syncing to disk.</p>

<h2>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Status</h2>

<p>JBase is reasonably stable, and since the code base is small enough, it's relatively immune to the most common forms of
'code rot'. I make improvements when they're needed, or if someone files an issue. That being said, I consider JBase
'production ready', provided you meet the intended use case.</p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>While I only work on JBase in my spare time (what little there is), I use it for several of my projects. I'm more than
happy to accept merge requests, and/or any issues filed. If you want to fork it and improve part of the API, I'm ok with
that too, however I ask you open an issue to discuss your proposed changes <em>first</em>. And, since it's MIT licensed, you
can, of course, take the code and use it in your own projects.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Morgul/jbase/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Morgul/jbase/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Morgul/jbase"></a> is maintained by <a href="https://github.com/Morgul">Morgul</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
